{% extends "base.html" %}

{% block content %}
<h2 class="page-title"><i class="fa-solid fa-users"></i> Gestion des Employés</h2>

{# Formulaire d'ajout d'employé - Amélioré #}
<div class="card form-card">
  <h3><i class="fa-solid fa-user-plus"></i> Ajouter un Nouvel Employé</h3>
  <form method="post" action="{{ request.url_for('employees_create') }}">
    {# Ligne 1: Prénom, Nom #}
    <div class="form-row">
      <div class="form-group">
        <label for="first_name">Prénom</label>
        <input type="text" id="first_name" name="first_name" required placeholder="Prénom de l'employé">
      </div>
      <div class="form-group">
        <label for="last_name">Nom</label>
        <input type="text" id="last_name" name="last_name" required placeholder="Nom de famille">
      </div>
    </div>
    {# Ligne 2: CIN, Poste #}
    <div class="form-row">
      <div class="form-group">
        <label for="cin">N° CIN</label> {# Nouveau champ CIN #}
        <input type="text" id="cin" name="cin" placeholder="Numéro de Carte d'Identité" pattern="\d*" title="Doit contenir uniquement des chiffres"> {# pattern pour chiffres seulement #}
      </div>
       <div class="form-group">
        <label for="position">Poste</label>
        <input type="text" id="position" name="position" required placeholder="Ex: Vendeur, Gérant, etc.">
      </div>
    </div>
    {# Ligne 3: Magasin #}
    <div class="form-row">
      <div class="form-group full-width"> {# Prend toute la largeur si seul élément #}
        <label for="branch_id">Magasin</label>
        {# Si l'utilisateur est manager, on affiche seulement son magasin et on le cache #}
        {% if user.role == 'manager' and manager_branch_id %}
            <input type="hidden" name="branch_id" value="{{ manager_branch_id }}">
            <p><strong>Magasin :</strong>
                {% for b in branches %}
                    {% if b.id == manager_branch_id %} {{ b.name }} ({{ b.city }}) {% endif %}
                {% endfor %}
            </p>
        {# Si l'utilisateur est admin, on affiche le select #}
        {% elif user.role == 'admin' %}
            <select id="branch_id" name="branch_id" required>
                <option value="" disabled selected>-- Choisir un magasin --</option>
                {% for b in branches %}
                <option value="{{ b.id }}">{{ b.name }} ({{ b.city }})</option>
                {% endfor %}
            </select>
        {% endif %}
      </div>
    </div>
    {# Bouton d'ajout #}
    <div class="form-actions">
      <button type="submit" class="btn btn-success">
        <i class="fa-solid fa-plus"></i> Ajouter Employé
      </button>
    </div>
  </form>
</div>


{# Tableau des employés - Amélioré #}
<div class="card table-card">
    <h3><i class="fa-solid fa-list-ul"></i> Liste des Employés</h3>
    {% if employees %}
    <div class="table-responsive">
        <table>
          <thead>
            <tr>
              <th>#</th>
              <th>Prénom</th>
              <th>Nom</th>
              <th>N° CIN</th> {# Nouvelle colonne CIN #}
              <th>Poste</th>
              <th>Magasin</th>
              <th>Statut</th>
            </tr>
          </thead>
          <tbody>
            {% for e in employees %}
            <tr>
              <td>{{ e.id }}</td>
              <td>{{ e.first_name }}</td>
              <td>{{ e.last_name }}</td>
              <td>{{ e.cin or '-' }}</td> {# Afficher CIN ou '-' #}
              <td>{{ e.position }}</td>
              <td>
                {# Afficher le nom du magasin au lieu de l'ID #}
                {% for b in branches %}
                  {% if b.id == e.branch_id %}
                    {{ b.name }}
                  {% endif %}
                {% endfor %}
              </td>
              <td>
                {# Utiliser des badges pour le statut #}
                {% if e.active %}
                  <span class="badge status-active">Actif</span>
                {% else %}
                  <span class="badge status-inactive">Inactif</span>
                {% endif %}
              </td>
              {# Ajouter potentiellement des boutons d'action (modifier, désactiver) pour l'admin #}
            </tr>
            {% endfor %}
          </tbody>
        </table>
    </div>
     {% else %}
        <p class="no-data">Aucun employé à afficher.</p>
     {% endif %}
</div>
{% endblock %}
