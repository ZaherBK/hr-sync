<h2 class="page-title"><i class="bi bi-person-circle"></i> Rapport Employé</h2>

<div class="card ranked-card">
  <h3>Sélectionner un Employé</h3>
  <form method="GET" action="{{ url_for('employee_report_index') }}">
    <div class="form-row align-items-end">
      <div class="form-group">
        <label for="employee">Employé</label>
        <select id="employee" name="employee_id" class="form-select" required>
          <option value="">-- Choisir un employé pour voir son rapport --</option>
          {% for e in employees %}
          <option value="{{ e.id }}" {% if employee and employee.id == e.id %}selected{% endif %}>
            {{ e.first_name }} {{ e.last_name }} ({{ e.id }})
          </option>
          {% endfor %}
        </select>
      </div>
      <div class="form-group">
        <button type="submit" class="btn btn-primary w-100"><i class="bi bi-search"></i> Afficher Rapport</button>
      </div>
    </div>
  </form>
</div>

{% if employee %}
<div class="card ranked-card">
  <h3>Détails pour : <strong>{{ employee.first_name }} {{ employee.last_name }}</strong></h3>
  <div class="employee-details">
    <p><strong>Poste :</strong> {{ employee.position }}</p>
    <p><strong>Salaire de Base :</strong> {{ employee.base_salary }} TND</p>
    <p><strong>Statut :</strong> <span class="status">Actif</span></p>
  </div>
</div>

<div class="tabs">
  <button class="active" data-tab="paie">Paie</button>
  <button data-tab="avances">Avances</button>
  <button data-tab="absences">Absences</button>
  <button data-tab="conges">Congés</button>
</div>

<div id="paie" class="tab-content active">
  <h4>Historique de Paie</h4>
  {% if pays %}
  <div class="table-responsive">
    <table>
      <thead><tr><th>Date</th><th>Type</th><th>Montant (TND)</th><th>Note</th><th>Enregistré le</th></tr></thead>
      <tbody>
        {% for p in pays %}
        <tr>
          <td>{{ p.date }}</td>
          <td>{{ p.type }}</td>
          <td>{{ p.amount }}</td>
          <td>{{ p.note or '-' }}</td>
          <td>{{ p.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% else %}<p class="no-data">Aucun paiement enregistré.</p>{% endif %}
</div>

<div id="avances" class="tab-content">
  <h4>Historique des Avances</h4>
  {% if avances %}
  <div class="table-responsive">
    <table>
      <thead><tr><th>Date</th><th>Montant</th><th>Note</th></tr></thead>
      <tbody>
        {% for a in avances %}
        <tr><td>{{ a.date }}</td><td>{{ a.amount }}</td><td>{{ a.note or '-' }}</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% else %}<p class="no-data">Aucune avance enregistrée.</p>{% endif %}
</div>

<div id="absences" class="tab-content">
  <h4>Absences</h4>
  {% if absences %}
  <div class="table-responsive">
    <table>
      <thead><tr><th>Date</th><th>Note</th></tr></thead>
      <tbody>
        {% for a in absences %}
        <tr><td>{{ a.date }}</td><td>{{ a.note or '-' }}</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% else %}<p class="no-data">Aucune absence enregistrée.</p>{% endif %}
</div>

<div id="conges" class="tab-content">
  <h4>Congés</h4>
  {% if conges %}
  <div class="table-responsive">
    <table>
      <thead><tr><th>Période</th><th>Type</th><th>Statut</th></tr></thead>
      <tbody>
        {% for c in conges %}
        <tr><td>{{ c.start_date }} → {{ c.end_date }}</td><td>{{ c.type }}</td><td>{{ c.status }}</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% else %}<p class="no-data">Aucun congé enregistré.</p>{% endif %}
</div>
{% endif %}
